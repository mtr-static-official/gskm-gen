<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ’ä»¶ç”Ÿæˆå™¨</title>
    <link href="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #e74c3c; /* ä¸»çº¢è‰² */
            --secondary-color: #f1c4c4; /* æµ…çº¢è‰² */
            --accent-color: #2c3e50; /* æ·±è“è‰² */
        }
    
        body {
        background: linear-gradient(135deg, #fff5f5 0%, #ffecec 100%),
                    url('data:image/svg+xml,<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="40" fill="none" stroke="%23ffcccc" stroke-width="2"/></svg>');
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    }
    
        .custom-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
    
        .custom-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 1rem;
            box-shadow: 0 0.5rem 1rem rgba(231, 76, 60, 0.1);
            border: 2px solid var(--primary-color);
            position: relative;
            overflow: hidden;
        }
    
        .custom-card::before {
            content: 'âšª';
            position: absolute;
            font-size: 8rem;
            opacity: 0.1;
            right: -2rem;
            top: -2rem;
            transform: rotate(45deg);
            color: var(--primary-color);
        }
    
        .function-block {
            background: #fff;
            border: 2px solid var(--primary-color);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            transition: transform 0.3s ease;
        }
    
        .function-block:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.2);
        }
    
        .function-block::before {
            content: 'â˜¯';
            position: absolute;
            left: -15px;
            top: -15px;
            background: white;
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }
    
        .btn-primary {
            background: var(--primary-color);
            border: none;
            border-radius: 20px;
            padding: 8px 20px;
            transition: all 0.3s ease;
        }
    
        .btn-primary:hover {
            background: #c0392b;
            transform: scale(1.05);
        }
    
        .btn-danger {
            background: #c0392b;
            border: none;
        }
    
        h1 {
        font-family: inherit; /* æ¢å¤é»˜è®¤å­—ä½“ */
        text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.1);
    }
    
        .character-setting {
            background: repeating-linear-gradient(
                45deg,
                #fff5f5,
                #fff5f5 10px,
                #ffecec 10px,
                #ffecec 20px
            );
            border-left: 4px solid var(--primary-color);
            font-family: Monaco, Consolas, 'Courier New', monospace;
        }
    
        .upload-area label {
            border: 2px dashed var(--primary-color);
            border-radius: 15px;
            transition: all 0.3s ease;
        }
    
        .upload-area label:hover {
            background: var(--primary-color) !important;
            transform: rotate(-2deg);
        }
    
        footer {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            padding: 1rem;
            box-shadow: 0 -2px 10px rgba(231, 76, 60, 0.05);
        }
    </style>

    </head>
<body>
    <div class="custom-container">
        <div class="custom-card p-4 p-md-5">
            <div class="d-flex justify-content-between align-items-center mb-5">
                <h1 class="text-center mb-0 display-4 fw-bold" style="background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                    â˜¯ æ’ä»¶ç”Ÿæˆå™¨
                </h1>
                <div class="upload-area">
                    <input type="file" id="jsonUpload" accept=".json" hidden>
                    <label for="jsonUpload" class="btn btn-outline-primary">
                        <i class="fas fa-upload me-2"></i>å¯¼å…¥JSON
                    </label>
                </div>
            </div>

            <div class="mb-4">
                <label for="addonName" class="form-label fw-bold">æ’ä»¶åç§°</label>
                <input type="text" class="form-control form-control-lg" id="addonName" placeholder="æˆ‘çš„æ’ä»¶">
            </div>

            <div class="mb-4">
                <label for="addonDescription" class="form-label fw-bold">æ’ä»¶æè¿°</label>
                <textarea class="form-control" id="addonDescription" rows="3" placeholder="è¿™ä¸ªæ’ä»¶çš„åŠŸèƒ½æ˜¯..."></textarea>
            </div>

            <div class="mb-4">
                <label for="addonIcon" class="form-label fw-bold">æ’ä»¶å›¾æ ‡ URL</label>
                <input type="url" class="form-control" id="addonIcon" placeholder="https://example.com/icon.png">
            </div>

            <div class="d-flex align-items-center justify-content-between mb-4">
                <h2 class="h4 fw-bold mb-0">ğŸ“¦ åŠŸèƒ½åˆ—è¡¨</h2>
                <button class="btn btn-primary btn-sm" onclick="addFunction()">
                    <i class="fas fa-plus me-2"></i>æ·»åŠ åŠŸèƒ½
                </button>
            </div>

            <div id="functions" class="functions-container"></div>

            <div class="d-grid mt-5">
                <button class="btn btn-success btn-lg py-3 fw-bold" onclick="generateAddon()">
                    <i class="fas fa-rocket me-2"></i>ç”Ÿæˆæ’ä»¶æ–‡ä»¶
                </button>
            </div>
        </div>

        <footer class="mt-4 pt-4 border-top">
            <div class="row justify-content-between">
                <div class="col-md-8">
                    <p class="text-muted small">
                        ç”± <a href="https://youmu.ltd" class="text-decoration-none">MTR</a> å¼€å‘ â€¢
                        æ„Ÿè°¢ <a href="https://github.com/Love-Kogasa" class="text-decoration-none">Love-Kogasa</a> â€¢
                        GitHub Copilot è¾…åŠ©å¼€å‘
                    </p>
                </div>
                <div class="col-md-4 text-md-end">
                    <p class="text-muted small">
                        æ‰˜ç®¡äº <a href="https://pages.cloudflare.com/" class="text-decoration-none">Cloudflare Pages</a>
                    </p>
                </div>
            </div>
        </footer>
    </div>

    <template id="functionTemplate">
        <div class="function-block position-relative">
            <button class="btn btn-danger btn-sm position-absolute top-0 end-0 m-2" onclick="removeFunction(this)">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="mb-3">
                <label class="form-label fw-bold">åŠŸèƒ½åç§°</label>
                <input type="text" class="form-control" name="functionName" required 
                       placeholder="åŠŸèƒ½è‹±æ–‡æ ‡è¯†ï¼ˆä¾‹å¦‚ï¼šf1ï¼Œåˆ‡å‹¿é‡å¤ï¼ï¼‰">
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">åŠŸèƒ½ç±»å‹</label>
                <select class="form-select" name="functionType" onchange="showFunctionDataFields(this)" required>
                    <option value="">è¯·é€‰æ‹©ç±»å‹</option>
                    <option value="new_gift">æ–°ç¤¼ç‰©</option>
                    <option value="new_character">è¦†ç›–è§’è‰²è®¾å®š</option>
                    <option value="add_character">è¿½åŠ è§’è‰²è®¾å®š</option>
                </select>
            </div>

            <div class="function-data-fields"></div>
        </div>
    </template>

    <script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/popper.js/2.11.2/cjs/popper.min.js"></script>
    <script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/bootstrap/5.1.3/js/bootstrap.min.js"></script>
    <script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/js/all.min.js" type="application/javascript"></script>
    <script>
        // åŠŸèƒ½ç®¡ç†
        function addFunction() {
            const template = document.getElementById('functionTemplate');
            const clone = template.content.cloneNode(true);
            document.getElementById('functions').appendChild(clone);
        }

        function removeFunction(btn) {
            btn.closest('.function-block').remove();
        }

        // åŠ¨æ€æ˜¾ç¤ºå­—æ®µ
        function showFunctionDataFields(select) {
            const container = select.closest('.function-block').querySelector('.function-data-fields');
            container.innerHTML = '';

            const type = select.value;
            let html = '';

            if (type === 'new_gift') {
                html = `
                    <div class="mb-3">
                        <label class="form-label">ç¤¼ç‰©åç§°</label>
                        <input type="text" class="form-control" name="giftName" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ç¤¼ç‰©æè¿°</label>
                        <textarea class="form-control" name="giftDescription" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">å›¾æ ‡URL</label>
                        <input type="url" class="form-control" name="giftIcon" required>
                    </div>
                `;
            } else if (type === 'new_character' || type === 'add_character') {
                html = `
                    <div class="mb-3">
                        <label class="form-label">è§’è‰²åç§°</label>
                        <input type="text" class="form-control" name="characterName" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">è¯¦ç»†è®¾å®š</label>
                        <textarea 
                            class="form-control character-setting" 
                            name="characterSetting" 
                            rows="6"
                            placeholder="è¯·è¾“å…¥å®Œæ•´çš„è§’è‰²è®¾å®šæè¿°ï¼ˆæ”¯æŒå¤šè¡Œæ–‡æœ¬ï¼‰\nç¤ºä¾‹ï¼š\nåšä¸½çµæ¢¦\n\nä¸œæ–¹Projectæ ¸å¿ƒè§’è‰²ï¼ŒZUNåˆ›ä½œã€‚\nåšä¸½ç¥ç¤¾å·«å¥³ï¼Œç»´æŠ¤å¹»æƒ³ä¹¡ç»“ç•Œã€‚\nçº¢ç™½éœ²è…‹è£…ï¼ŒæŒå¾¡å¸é˜´é˜³ç‰ã€‚\nå¤©ç„¶ä¹è§‚ï¼Œé£è¡Œç¬¦å¡æ”»å‡»ï¼Œâ€œæ¢¦æƒ³å¤©ç”Ÿâ€ç»æŠ€ã€‚\nè±¡å¾è‡ªç”±å¹»æƒ³ï¼Œç³»åˆ—äººæ°”æœ€é«˜å½¢è±¡ã€‚"
                            required></textarea>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        // JSONå¯¼å…¥åŠŸèƒ½
        document.getElementById('jsonUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const jsonData = JSON.parse(e.target.result);
                    loadJsonData(jsonData);
                } catch (error) {
                    alert('æ–‡ä»¶è§£æå¤±è´¥: ' + error.message);
                }
            };
            reader.readAsText(file);
        });

        function loadJsonData(data) {
            // æ¸…ç©ºç°æœ‰æ•°æ®
            document.getElementById('addonName').value = data.header?.name || '';
            document.getElementById('addonDescription').value = data.header?.description || '';
            document.getElementById('addonIcon').value = data.header?.icon || '';
            document.getElementById('functions').innerHTML = '';

            // åŠ è½½åŠŸèƒ½æ¨¡å—
            for (const [funcName, funcData] of Object.entries(data)) {
                if (funcName === 'header' || funcName === 'main') continue;

                const functionType = Object.keys(funcData)[0];
                const functionConfig = funcData[functionType];
                
                addFunction();
                const currentBlock = document.getElementById('functions').lastElementChild;

                // å¡«å……åŸºç¡€ä¿¡æ¯
                currentBlock.querySelector('[name="functionName"]').value = funcName;
                currentBlock.querySelector('[name="functionType"]').value = functionType;
                
                // è§¦å‘ç±»å‹å˜æ›´
                const select = currentBlock.querySelector('[name="functionType"]');
                select.dispatchEvent(new Event('change'));
                
                // å¡«å……è¯¦ç»†æ•°æ®
                if (functionType === 'new_gift') {
                    currentBlock.querySelector('[name="giftName"]').value = functionConfig.name;
                    currentBlock.querySelector('[name="giftDescription"]').value = functionConfig.description;
                    currentBlock.querySelector('[name="giftIcon"]').value = functionConfig.icon;
                } else if (functionType === 'new_character' || functionType === 'add_character') {
                    currentBlock.querySelector('[name="characterName"]').value = functionConfig.name;
                    currentBlock.querySelector('[name="characterSetting"]').value = 
                        typeof functionConfig.character === 'string' ? 
                        functionConfig.character :
                        JSON.stringify(functionConfig.character, null, 2);
                }
            }
        }

        // ç”Ÿæˆæ’ä»¶æ–‡ä»¶
        function generateAddon() {
            const addon = {
                "header": {
                    "name": document.getElementById('addonName').value,
                    "description": document.getElementById('addonDescription').value,
                    "icon": document.getElementById('addonIcon').value
                },
                "main": {}
            };

            document.querySelectorAll('.function-block').forEach(funcBlock => {
                const functionName = funcBlock.querySelector('[name="functionName"]').value;
                const functionType = funcBlock.querySelector('[name="functionType"]').value;
                const functionData = {};

                if (functionType === 'new_gift') {
                    functionData.name = funcBlock.querySelector('[name="giftName"]').value;
                    functionData.description = funcBlock.querySelector('[name="giftDescription"]').value;
                    functionData.icon = funcBlock.querySelector('[name="giftIcon"]').value;
                } else if (functionType === 'new_character' || functionType === 'add_character') {
                    functionData.name = funcBlock.querySelector('[name="characterName"]').value;
                    functionData.character = funcBlock.querySelector('[name="characterSetting"]').value;
                }

                addon[functionName] = { [functionType]: functionData };
                addon.main[functionName] = {};
            });

            downloadAddon(addon);
        }

        // æ–‡ä»¶ä¸‹è½½
        function downloadAddon(addon) {
            const json = JSON.stringify(addon, null, 2);
            const blob = new Blob([json], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `addon_${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>